!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.14 (r7259) - 18 Jan 2019 09:36
!
MODULE COMPUTE_ENTROPY_MOD_DIFF
#include <petsc/finclude/petscsys.h>
  USE DATA_STRUCTURE_MOD_DIFF
  USE PETSC_DATA_STRUCTURE_MOD
  IMPLICIT NONE

CONTAINS
  SUBROUTINE COMPUTE_ENTROPY()
    IMPLICIT NONE
! call MPI_Allreduce(total_entropy, gtotal_entropy , 1, &
! & MPI_DOUBLE, MPI_SUM, PETSC_COMM_WORLD, ierr)
! if(rank == 0) then
!     !write(*,*)"total entropy :", gtotal_entropy
! end if
    INTEGER :: k
    REAL*8 :: temp1, temp2
    REAL*8 :: gtotal_entropy
    INTRINSIC DLOG
    INTRINSIC DABS
    DOUBLE PRECISION :: dabs0
    PetscErrorCode :: ierr
    total_entropy = 0.d0
    temp2 = DLOG(pr_inf)
    DO k=1,local_points
      temp1 = point%prim(1, k)**gamma
      temp1 = point%prim(4, k)/temp1
      temp1 = DLOG(temp1)
      IF (temp1 - temp2 .GE. 0.) THEN
        point%entropy(k) = temp1 - temp2
      ELSE
        point%entropy(k) = -(temp1-temp2)
      END IF
      IF (temp1 - temp2 .GE. 0.) THEN
        dabs0 = temp1 - temp2
      ELSE
        dabs0 = -(temp1-temp2)
      END IF
      total_entropy = total_entropy + dabs0
    END DO
  END SUBROUTINE COMPUTE_ENTROPY

END MODULE COMPUTE_ENTROPY_MOD_DIFF
