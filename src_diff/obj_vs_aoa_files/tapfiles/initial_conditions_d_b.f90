!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.14 (r7079) -  5 Oct 2018 09:56
!
!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.14 (r7079) -  5 Oct 2018 09:56
!
MODULE INITIAL_CONDITIONS_MOD_DIFF_DIFF
  USE DATA_STRUCTURE_MOD_DIFF_DIFF
  USE PARAMETER_MOD_DIFF
  IMPLICIT NONE

CONTAINS
!  Differentiation of initial_conditions in forward (tangent) mode (with options fixinterface):
!   variations   of useful results: q_inf theta point.prim
!   with respect to varying inputs: aoa
  SUBROUTINE INITIAL_CONDITIONS_D()
    IMPLICIT NONE
    INTEGER :: k, i
    INTEGER :: rank
    IF (restart .EQ. 0) THEN
      CALL SETUP_CASE_PARAMETERS_D()
      pointd%prim = 0.0_8
      DO k=1,max_points
        pointd%prim(1, k) = q_initd(1)
        point%prim(1, k) = q_init(1)
        pointd%prim(2, k) = q_initd(2)
        point%prim(2, k) = q_init(2)
        pointd%prim(3, k) = q_initd(3)
        point%prim(3, k) = q_init(3)
        pointd%prim(4, k) = q_initd(4)
        point%prim(4, k) = q_init(4)
      END DO
    ELSE IF (restart .EQ. 1) THEN
      IF (rank .EQ. 0) THEN
        WRITE(*, *) '%%%%%%%%%%%%-Using restart file-%%%%%%%%%%%'
        WRITE(*, *) 
      END IF
      CALL SETUP_CASE_PARAMETERS_D()
      CALL RESTART_SOL()
      pointd%prim = 0.0_8
    ELSE
      q_infd = 0.0_8
      thetad = 0.0_8
      pointd%prim = 0.0_8
    END IF
  END SUBROUTINE INITIAL_CONDITIONS_D

  SUBROUTINE INITIAL_CONDITIONS()
    IMPLICIT NONE
    INTEGER :: k, i
    INTEGER :: rank
    IF (restart .EQ. 0) THEN
      CALL SETUP_CASE_PARAMETERS()
      DO k=1,max_points
        point%prim(1, k) = q_init(1)
        point%prim(2, k) = q_init(2)
        point%prim(3, k) = q_init(3)
        point%prim(4, k) = q_init(4)
      END DO
    ELSE IF (restart .EQ. 1) THEN
      IF (rank .EQ. 0) THEN
        WRITE(*, *) '%%%%%%%%%%%%-Using restart file-%%%%%%%%%%%'
        WRITE(*, *) 
      END IF
      CALL SETUP_CASE_PARAMETERS()
      CALL RESTART_SOL()
    END IF
  END SUBROUTINE INITIAL_CONDITIONS

  SUBROUTINE RESTART_SOL()
    IMPLICIT NONE
    INTEGER :: i, dummy
    CHARACTER(len=64) :: sfile
    CHARACTER(len=10) :: itos
    INTRINSIC TRIM
    INTEGER :: proc
    TYPE(UNKNOWNTYPE) :: rank
    IF (proc .EQ. 1) THEN
      sfile = 'restart/sol.dat'
    ELSE
      sfile = 'restart/'//'sol-'//TRIM(itos(4, rank))//'.dat'
    END IF
    OPEN(unit=515, file=trim(sfile), form='formatted', action='read') 
    READ(515, *) dummy, itr, res_old
    DO i=1,local_points
      READ(515, *) dummy, dummy, dummy, dummy, dummy, point%prim(1, i), &
&    point%prim(2, i), point%prim(3, i), point%prim(4, i)
    END DO
    CLOSE(515) 
  END SUBROUTINE RESTART_SOL

END MODULE INITIAL_CONDITIONS_MOD_DIFF_DIFF

