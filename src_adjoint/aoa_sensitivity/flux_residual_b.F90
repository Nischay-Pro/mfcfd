!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.14 (r7079) -  5 Oct 2018 09:56
!
!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.14 (r7079) -  5 Oct 2018 09:56
!
MODULE FLUX_RESIDUAL_MOD_DIFF_DIFF
  USE PARAMETER_MOD
  USE DATA_STRUCTURE_MOD_DIFF
  USE INTERIOR_FLUXES_MOD_DIFF_DIFF
  USE WALL_FLUXES_MOD_DIFF_DIFF
  USE OUTER_FLUXES_MOD_DIFF_DIFF
  IMPLICIT NONE

CONTAINS
!  Differentiation of cal_flux_residual_d in reverse (adjoint) mode (with options fixinterface):
!   gradient     of useful results: pointd.flux_res pointd.q pointd.dq
!                pointd.qm pointd.delta point.x point.y point.nx
!                point.ny point.flux_res point.q point.dq point.qm
!                point.delta
!   with respect to varying inputs: pointd.flux_res pointd.q pointd.dq
!                pointd.qm pointd.delta point.x point.y point.nx
!                point.ny point.flux_res point.q point.dq point.qm
!                point.delta
!  Differentiation of cal_flux_residual in forward (tangent) mode (with options fixinterface):
!   variations   of useful results: point.flux_res
!   with respect to varying inputs: point.flux_res point.q point.dq
!                point.qm point.delta
  SUBROUTINE CAL_FLUX_RESIDUAL_D_B()
    IMPLICIT NONE
    INTEGER :: i, k
    REAL*8 :: gxp(4), gxn(4), gyp(4), gyn(4)
    REAL*8 :: gxpb(4), gxnb(4), gypb(4), gynb(4)
    REAL*8 :: gxpd(4), gxnd(4), gypd(4), gynd(4)
    REAL*8 :: gxpdb(4), gxndb(4), gypdb(4), gyndb(4)
    REAL*8, DIMENSION(4) :: tempb
    REAL*8, DIMENSION(4) :: tempb0
    REAL*8, DIMENSION(4) :: tempb1
    REAL*8, DIMENSION(4) :: tempb2
    REAL*8, DIMENSION(4) :: tempb3
    REAL*8, DIMENSION(4) :: tempb4
    REAL*8, DIMENSION(4) :: tempb5
    DO i=1,wall_points
      k = wall_points_index(i)
      CALL WALL_DGX_POS_D(gxp, gxpd, k)
      CALL WALL_DGX_NEG_D(gxn, gxnd, k)
      CALL WALL_DGY_NEG_D(gyn, gynd, k)
      CALL PUSHREAL8ARRAY(pointd%flux_res(:, k), 4)
      pointd%flux_res(:, k) = gxpd + gxnd + gynd
      CALL PUSHREAL8ARRAY(point%flux_res(:, k), 4)
      point%flux_res(:, k) = gxp + gxn + gyn
      CALL PUSHREAL8ARRAY(pointd%flux_res(:, k), 4)
      pointd%flux_res(:, k) = 2.0d0*(pointd%delta(k)*point%flux_res(:, k&
&       )+point%delta(k)*pointd%flux_res(:, k))
      CALL PUSHREAL8ARRAY(point%flux_res(:, k), 4)
      point%flux_res(:, k) = 2.0d0*point%delta(k)*point%flux_res(:, k)
    END DO
    DO i=1,outer_points
      k = outer_points_index(i)
      CALL PUSHREAL8ARRAY(gxpd, 4)
      CALL PUSHREAL8ARRAY(gxp, 4)
      CALL OUTER_DGX_POS_D(gxp, gxpd, k)
      CALL PUSHREAL8ARRAY(gxnd, 4)
      CALL PUSHREAL8ARRAY(gxn, 4)
      CALL OUTER_DGX_NEG_D(gxn, gxnd, k)
      CALL PUSHREAL8ARRAY(gypd, 4)
      CALL PUSHREAL8ARRAY(gyp, 4)
      CALL OUTER_DGY_POS_D(gyp, gypd, k)
    END DO
    DO i=1,interior_points
      k = interior_points_index(i)
      CALL PUSHREAL8ARRAY(gxpd, 4)
      CALL PUSHREAL8ARRAY(gxp, 4)
      CALL INTERIOR_DGX_POS_D(gxp, gxpd, k)
      CALL PUSHREAL8ARRAY(gxnd, 4)
      CALL PUSHREAL8ARRAY(gxn, 4)
      CALL INTERIOR_DGX_NEG_D(gxn, gxnd, k)
      CALL PUSHREAL8ARRAY(gypd, 4)
      CALL PUSHREAL8ARRAY(gyp, 4)
      CALL INTERIOR_DGY_POS_D(gyp, gypd, k)
      CALL PUSHREAL8ARRAY(gynd, 4)
      CALL PUSHREAL8ARRAY(gyn, 4)
      CALL INTERIOR_DGY_NEG_D(gyn, gynd, k)
    END DO
    DO i=interior_points,1,-1
      k = interior_points_index(i)
      gxnb = 0.0_8
      gxpb = 0.0_8
      gynb = 0.0_8
      gypb = 0.0_8
      tempb3 = point%delta(k)*pointb%flux_res(:, k)
      pointb%delta(k) = pointb%delta(k) + SUM((gxpd+gxnd+gypd+gynd)*&
&       pointdb%flux_res(:, k)) + SUM((gxp+gxn+gyp+gyn)*pointb%flux_res(&
&       :, k))
      pointb%flux_res(:, k) = 0.0_8
      gxndb = 0.0_8
      gypdb = 0.0_8
      gyndb = 0.0_8
      gxpdb = 0.0_8
      tempb4 = pointd%delta(k)*pointdb%flux_res(:, k)
      gxpb = tempb4 + tempb3
      gxnb = tempb4 + tempb3
      gypb = tempb4 + tempb3
      gynb = tempb4 + tempb3
      tempb5 = point%delta(k)*pointdb%flux_res(:, k)
      pointdb%delta(k) = pointdb%delta(k) + SUM((gxp+gxn+gyp+gyn)*&
&       pointdb%flux_res(:, k))
      gxpdb = tempb5
      gxndb = tempb5
      gypdb = tempb5
      gyndb = tempb5
      pointdb%flux_res(:, k) = 0.0_8
      CALL POPREAL8ARRAY(gyn, 4)
      CALL POPREAL8ARRAY(gynd, 4)
      CALL INTERIOR_DGY_NEG_D_B(gyn, gynb, gynd, gyndb, k)
      CALL POPREAL8ARRAY(gyp, 4)
      CALL POPREAL8ARRAY(gypd, 4)
      CALL INTERIOR_DGY_POS_D_B(gyp, gypb, gypd, gypdb, k)
      CALL POPREAL8ARRAY(gxn, 4)
      CALL POPREAL8ARRAY(gxnd, 4)
      CALL INTERIOR_DGX_NEG_D_B(gxn, gxnb, gxnd, gxndb, k)
      CALL POPREAL8ARRAY(gxp, 4)
      CALL POPREAL8ARRAY(gxpd, 4)
      CALL INTERIOR_DGX_POS_D_B(gxp, gxpb, gxpd, gxpdb, k)
    END DO
    DO i=outer_points,1,-1
      k = outer_points_index(i)
      gxnb = 0.0_8
      gxpb = 0.0_8
      gypb = 0.0_8
      tempb0 = point%delta(k)*pointb%flux_res(:, k)
      pointb%delta(k) = pointb%delta(k) + SUM((gxpd+gxnd+gypd)*pointdb%&
&       flux_res(:, k)) + SUM((gxp+gxn+gyp)*pointb%flux_res(:, k))
      pointb%flux_res(:, k) = 0.0_8
      gxndb = 0.0_8
      gypdb = 0.0_8
      gxpdb = 0.0_8
      tempb1 = pointd%delta(k)*pointdb%flux_res(:, k)
      gxpb = tempb1 + tempb0
      gxnb = tempb1 + tempb0
      gypb = tempb1 + tempb0
      tempb2 = point%delta(k)*pointdb%flux_res(:, k)
      pointdb%delta(k) = pointdb%delta(k) + SUM((gxp+gxn+gyp)*pointdb%&
&       flux_res(:, k))
      gxpdb = tempb2
      gxndb = tempb2
      gypdb = tempb2
      pointdb%flux_res(:, k) = 0.0_8
      CALL POPREAL8ARRAY(gyp, 4)
      CALL POPREAL8ARRAY(gypd, 4)
      CALL OUTER_DGY_POS_D_B(gyp, gypb, gypd, gypdb, k)
      CALL POPREAL8ARRAY(gxn, 4)
      CALL POPREAL8ARRAY(gxnd, 4)
      CALL OUTER_DGX_NEG_D_B(gxn, gxnb, gxnd, gxndb, k)
      CALL POPREAL8ARRAY(gxp, 4)
      CALL POPREAL8ARRAY(gxpd, 4)
      CALL OUTER_DGX_POS_D_B(gxp, gxpb, gxpd, gxpdb, k)
    END DO
    DO i=wall_points,1,-1
      k = wall_points_index(i)
      CALL POPREAL8ARRAY(point%flux_res(:, k), 4)
      CALL POPREAL8ARRAY(pointd%flux_res(:, k), 4)
      tempb = 2.0d0*pointdb%flux_res(:, k)
      pointb%delta(k) = pointb%delta(k) + SUM(pointd%flux_res(:, k)*&
&       tempb) + 2.0d0*SUM(point%flux_res(:, k)*pointb%flux_res(:, k))
      pointb%flux_res(:, k) = pointd%delta(k)*tempb + 2.0d0*point%delta(&
&       k)*pointb%flux_res(:, k)
      pointdb%delta(k) = pointdb%delta(k) + SUM(point%flux_res(:, k)*&
&       tempb)
      pointdb%flux_res(:, k) = point%delta(k)*tempb
      gxnb = 0.0_8
      gxpb = 0.0_8
      gynb = 0.0_8
      CALL POPREAL8ARRAY(point%flux_res(:, k), 4)
      gxpb = pointb%flux_res(:, k)
      gxnb = pointb%flux_res(:, k)
      gynb = pointb%flux_res(:, k)
      pointb%flux_res(:, k) = 0.0_8
      gxndb = 0.0_8
      gyndb = 0.0_8
      gxpdb = 0.0_8
      CALL POPREAL8ARRAY(pointd%flux_res(:, k), 4)
      gxpdb = pointdb%flux_res(:, k)
      gxndb = pointdb%flux_res(:, k)
      gyndb = pointdb%flux_res(:, k)
      pointdb%flux_res(:, k) = 0.0_8
      CALL WALL_DGY_NEG_D_B(gyn, gynb, gynd, gyndb, k)
      CALL WALL_DGX_NEG_D_B(gxn, gxnb, gxnd, gxndb, k)
      CALL WALL_DGX_POS_D_B(gxp, gxpb, gxpd, gxpdb, k)
    END DO
  END SUBROUTINE CAL_FLUX_RESIDUAL_D_B

!  Differentiation of cal_flux_residual in forward (tangent) mode (with options fixinterface):
!   variations   of useful results: point.flux_res
!   with respect to varying inputs: point.flux_res point.q point.dq
!                point.qm point.delta
  SUBROUTINE CAL_FLUX_RESIDUAL_D()
    IMPLICIT NONE
    INTEGER :: i, k
    REAL*8 :: gxp(4), gxn(4), gyp(4), gyn(4)
    REAL*8 :: gxpd(4), gxnd(4), gypd(4), gynd(4)
    DO i=1,wall_points
      k = wall_points_index(i)
      CALL WALL_DGX_POS_D(gxp, gxpd, k)
      CALL WALL_DGX_NEG_D(gxn, gxnd, k)
      CALL WALL_DGY_NEG_D(gyn, gynd, k)
      pointd%flux_res(:, k) = gxpd + gxnd + gynd
      point%flux_res(:, k) = gxp + gxn + gyn
      pointd%flux_res(:, k) = 2.0d0*(pointd%delta(k)*point%flux_res(:, k&
&       )+point%delta(k)*pointd%flux_res(:, k))
      point%flux_res(:, k) = 2.0d0*point%delta(k)*point%flux_res(:, k)
    END DO
    DO i=1,outer_points
      k = outer_points_index(i)
      CALL OUTER_DGX_POS_D(gxp, gxpd, k)
      CALL OUTER_DGX_NEG_D(gxn, gxnd, k)
      CALL OUTER_DGY_POS_D(gyp, gypd, k)
      pointd%flux_res(:, k) = pointd%delta(k)*(gxp+gxn+gyp) + point%&
&       delta(k)*(gxpd+gxnd+gypd)
      point%flux_res(:, k) = point%delta(k)*(gxp+gxn+gyp)
    END DO
    DO i=1,interior_points
      k = interior_points_index(i)
      CALL INTERIOR_DGX_POS_D(gxp, gxpd, k)
      CALL INTERIOR_DGX_NEG_D(gxn, gxnd, k)
      CALL INTERIOR_DGY_POS_D(gyp, gypd, k)
      CALL INTERIOR_DGY_NEG_D(gyn, gynd, k)
      pointd%flux_res(:, k) = pointd%delta(k)*(gxp+gxn+gyp+gyn) + point%&
&       delta(k)*(gxpd+gxnd+gypd+gynd)
      point%flux_res(:, k) = point%delta(k)*(gxp+gxn+gyp+gyn)
    END DO
  END SUBROUTINE CAL_FLUX_RESIDUAL_D

  SUBROUTINE CAL_FLUX_RESIDUAL()
    IMPLICIT NONE
    INTEGER :: i, k
    REAL*8 :: gxp(4), gxn(4), gyp(4), gyn(4)
    DO i=1,wall_points
      k = wall_points_index(i)
      CALL WALL_DGX_POS(gxp, k)
      CALL WALL_DGX_NEG(gxn, k)
      CALL WALL_DGY_NEG(gyn, k)
      point%flux_res(:, k) = gxp + gxn + gyn
      point%flux_res(:, k) = 2.0d0*point%delta(k)*point%flux_res(:, k)
    END DO
    DO i=1,outer_points
      k = outer_points_index(i)
      CALL OUTER_DGX_POS(gxp, k)
      CALL OUTER_DGX_NEG(gxn, k)
      CALL OUTER_DGY_POS(gyp, k)
      point%flux_res(:, k) = point%delta(k)*(gxp+gxn+gyp)
    END DO
    DO i=1,interior_points
      k = interior_points_index(i)
      CALL INTERIOR_DGX_POS(gxp, k)
      CALL INTERIOR_DGX_NEG(gxn, k)
      CALL INTERIOR_DGY_POS(gyp, k)
      CALL INTERIOR_DGY_NEG(gyn, k)
      point%flux_res(:, k) = point%delta(k)*(gxp+gxn+gyp+gyn)
    END DO
  END SUBROUTINE CAL_FLUX_RESIDUAL

END MODULE FLUX_RESIDUAL_MOD_DIFF_DIFF

